---
title: "Radiocarbon Dating by Location, Chronology and Material Life Duration"
author: "Thomas Huet, Niccolo Mazzucco"
date: "11/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 19, fig.height = 14)
library(kableExtra)
library(dplyr)
library(knitr)
library(magick)
GHimgs <- "https://github.com/zoometh/C14/tree/main/docs/imgs/"
c14.db.url <- c("http://telearchaeology.org/c14-databses/","http://www.britarch.ac.uk/info/c14.html","http://www.archeometrie.mom.fr/banadora/","http://discovery.ucl.ac.uk/1469811")
c14.db.names <- c("telearchaeology","Archaeological Site Index to Radiocarbon Dates from Great Britain and Ireland","BANADORA","EUROEVOL")
```

# RShiny C14 dating interactive maps

Today exists a lot of databases or database portals for C14 datings

```{r dat.db, echo=FALSE}
c14.db.df <- data.frame(names=c14.db.names,
                        url=c14.db.url,
                        stringsAsFactors = F)
kable(c14.db.df,"html") %>%
  kable_styling(full_width = FALSE, position = "center", font_size=9)
```

Online app also exist for C14 calibration: [OxCal](https://c14.arch.ox.ac.uk/oxcal/), [CalPal](http://www.calpal-online.de/), etc.

But few solutions exist for data vizualisation. Since, the idea was to create an interactive web form map-based for selection of radiocarbon data. R and Leaflet offer easy programming solutions to create such interactive maps.

## EUROEVOL_R and NeoNet apps

There is two RShiny apps with the more or less same options. Only the dataset changes:

* [EUROEVOL_R](https://archaepigraph.shinyapps.io/EUROEVOL_R/) is based on the [EUROEVOL database](http://discovery.ucl.ac.uk/1469811/) and covers the Central, Western and Northern Europe
* [NeoNet](https://neolithic.shinyapps.io/NeoNet/) is based on a Google Sheet and covers the Central Mediterranean


## Tutorial

The apps are divided into 4 panels:

* map
* calib
* data
* credits


### **map** panel
![](https://raw.githubusercontent.com/zoometh/C14/main/docs/imgs/panel_map_idx.png)

The panel for Radiocarbon Dating by Location, Chronology and Material Life Duration.

* The top-left button **group c14 on map** (<span style="color:red">red</span> box) allows to cluster datations by spatial proximities (see [Marker Clusters](http://rstudio.github.io/leaflet/markers.html))
* The bottom-left legend **periods** (<span style="color:orange">orange</span> box) is a dynamic list of periods which exist in the selection (see checkboxes  **periods**)
* The bottom-left slider  **tpq\taq** (<span style="color:blue">blue</span> box) allows to subset a range of dating between a tpq and a taq (in cal BC) 
* The bottom-right checkboxes and slider  **material life duration...** (<span style="color:purple">purple</span> box) allow to subset a range of dating relatively to the duration of their material (short to long-life material) and/or to determine the maximum threshold for standard errors (SD) for the datations 
* The top-right checkboxes  **periods** (<span style="color:brown">brown</span> box) allows to select dataions by periods 
* The table at the bottom (<span style="color:green">green</span> box) is a dynamic table which list all the datations within the map and in the selection (tpq/taq, material life duration, maximum SD, periods). A count of selected sites and selected datations is dynamically done above this table.

```{r panel.map,echo=FALSE,message=FALSE, out.width = "200%"}
# # A tibble: 1 x 7
#   format width height colorspace matte filesize density
#   <chr>  <int>  <int> <chr>      <lgl>    <int> <chr>  
# 1 PNG     1664    886 sRGB       TRUE   1496175 118x118
panel.map <- image_read("https://raw.githubusercontent.com/zoometh/C14/main/docs/imgs/panels_map.png")
map.group.c14 <- image_draw(panel.map)
# xleft, ybottom, xright, ytop
# Group button
rect(20, 30, 200, 160,
     border = "red", lty = "dashed", lwd = 4)
# dynamic periods
rect(20, 750, 130, 600,
     border = "orange", lty = "dashed", lwd = 4)
# slider
rect(150, 720, 800, 650,
     border = "blue", lty = "dashed", lwd = 4)
# dynamic table
rect(20, 886, 1650, 770,
     border = "green", lty = "dashed", lwd = 4)
# SDs
rect(1300, 720, 1650, 600,
     border = "purple", lty = "dashed", lwd = 4)
# button periods
rect(1450, 30, 1650, 550,
     border = "brown", lty = "dashed", lwd = 4)
invisible(dev.off())
plot(map.group.c14)
```

### **calib** panel
![](https://raw.githubusercontent.com/zoometh/C14/main/docs/imgs/panel_calib_idx.png)

```{r panel.calib,echo=FALSE,message=FALSE, out.width = "200%"}
# # A tibble: 1 x 7
#   format width height colorspace matte filesize density
#   <chr>  <int>  <int> <chr>      <lgl>    <int> <chr>  
# 1 PNG     1664    886 sRGB       TRUE   1496175 118x118
panel.map <- image_read("https://raw.githubusercontent.com/zoometh/C14/main/docs/imgs/panels_calib.png")
calib.group.c14 <- image_draw(panel.map)
# # xleft, ybottom, xright, ytop
# # Group button
# rect(20, 30, 200, 160,
#      border = "red", lty = "dashed", lwd = 4)
# # dynamic periods
# rect(20, 750, 130, 600,
#      border = "orange", lty = "dashed", lwd = 4)
# # slider
# rect(150, 720, 800, 650,
#      border = "blue", lty = "dashed", lwd = 4)
# # dynamic table
# rect(20, 886, 1650, 770,
#      border = "green", lty = "dashed", lwd = 4)
# # SDs
# rect(1300, 720, 1650, 600,
#      border = "purple", lty = "dashed", lwd = 4)
# # button periods
# rect(1450, 30, 1650, 550,
#      border = "brown", lty = "dashed", lwd = 4)
invisible(dev.off())
plot(map.group.c14)
```

